<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ì˜ì–´ í•™ìŠµ ë„ìš°ë¯¸</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600&display=swap" rel="stylesheet">
  <style>
    :root {
      --primary: #3498db;
      --primary-dark: #2980b9;
      --secondary: #2ecc71;
      --bg-page: #f4f7fa;
      --bg-card: #fff;
      --text: #333;
      --text-light: #666;
      --radius: 8px;
      --trans: 0.2s;
    }
    * { box-sizing: border-box; margin:0; padding:0 }
    body {
      font-family: 'Inter', sans-serif;
      background: var(--bg-page);
      color: var(--text);
      padding: 20px;
      line-height:1.6;
    }
    h1{ text-align:center; margin-bottom:20px; font-weight:600 }
    .card {
      background: var(--bg-card);
      border-radius: var(--radius);
      box-shadow: 0 2px 6px rgba(0,0,0,0.1);
      padding:20px; margin-bottom:20px;
    }
    label { display:block; margin-bottom:12px; font-weight:500 }
    input, textarea {
      width:100%; padding:10px; margin-top:6px;
      border:1px solid #ddd; border-radius:var(--radius);
      transition: border-color var(--trans);
    }
    input:focus, textarea:focus {
      border-color: var(--primary);
      outline:none;
    }
    button {
      display:inline-block;
      padding:10px 16px; margin:8px 8px 0 0;
      font-size:1rem; color:#fff; border:none;
      border-radius: var(--radius);
      background: var(--primary);
      cursor:pointer; transition: background var(--trans);
    }
    button.secondary { background: var(--secondary) }
    button:hover { background: var(--primary-dark) }
    button.secondary:hover { background: #27ae60 }
    #wordlist-tree details {
      margin-bottom:8px;
      border:1px solid #eee;
      border-radius:var(--radius);
      padding:8px 12px;
      background:#fafafa;
    }
    #wordlist-tree summary {
      font-weight:600; cursor:pointer; list-style:none;
    }
    #wordlist-tree summary::-webkit-details-marker { display:none }
    #wordlist-tree summary::before {
      content:'â–¸'; display:inline-block; margin-right:6px;
      transition: transform var(--trans);
    }
    #wordlist-tree details[open] summary::before {
      transform: rotate(90deg);
    }
    #wordlist-tree li {
      margin:4px 0 0 16px; color: var(--text-light);
      cursor:pointer; transition: color var(--trans);
    }
    #wordlist-tree li:hover { color: var(--text) }
  </style>
</head>
<body>

  <h1>ì˜ì–´ í•™ìŠµ ë„ìš°ë¯¸</h1>

  <div class="card">
    <h2>1. ë‹¨ì–´ì¥ ì €ì¥</h2>
    <label>ëŒ€ë¶„ë¥˜
      <input id="inputCategory" placeholder="êµê³¼ì„œ, ëª¨ì˜ê³ ì‚¬ ë“±" />
    </label>
    <label>ì¤‘ë¶„ë¥˜
      <input id="inputSubcategory" placeholder="ì˜¬ë¦¼í¬ìŠ¤ 1ê°• ë“±" />
    </label>
    <label>ì œëª©
      <input id="inputTitle" placeholder="ì˜¬ë¦¼í¬ìŠ¤1" />
    </label>
    <label>ë‹¨ì–´Â·ëœ» (í•œ ì¤„ì— â€œë‹¨ì–´ ëœ»â€)
      <textarea id="inputWords" rows="5" placeholder="importance ì¤‘ìš”ì„±&#10;prominence ë‘ë“œëŸ¬ì§"></textarea>
    </label>
    <button id="save-wordlist-btn">ì €ì¥í•˜ê¸°</button>
    <button id="load-wordlists-btn" class="secondary">ì €ì¥ëœ ëª©ë¡ ë¶ˆëŸ¬ì˜¤ê¸°</button>
  </div>

  <div class="card">
    <h2>2. ë‹¨ì–´ì¥ ëª©ë¡</h2>
    <div id="wordlist-tree"></div>
  </div>

  <div class="card">
    <h2>3. ìŠ¬ë¼ì´ë“œ í…ŒìŠ¤íŠ¸</h2>
    <button id="start-slide-test-btn" class="secondary">í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
    <div style="font-size:0.9rem; color:var(--text-light); margin-top:8px;">
      â€» ëª©ë¡ì—ì„œ ë‹¨ì–´ì¥ì„ ì„ íƒí•˜ë©´ í…ŒìŠ¤íŠ¸ íƒ­ì„ ì—¬ëŠ” ì°½ì´ ëœ¹ë‹ˆë‹¤.
    </div>
  </div>

  <script>
    // util
    function shuffle(arr) {
      for (let i = arr.length-1; i>0; i--){
        const j = Math.floor(Math.random()*(i+1));
        [arr[i],arr[j]]=[arr[j],arr[i]];
      }
      return arr;
    }

    // 1) ì €ì¥ â†’ ì´ˆê¸°í™”
    save-wordlist-btn.addEventListener('click', async () => {
      const cat  = inputCategory.value.trim();
      const sub  = inputSubcategory.value.trim();
      const title= inputTitle.value.trim();
      const words = inputWords.value.trim().split('\n')
        .map(l=>{ const [w,...m]=l.trim().split(/\s+/); return {word:w,meaning:m.join(' ')} });

      if(!cat||!sub||!title||!words.length) return alert('ëª¨ë“  í•­ëª© ì…ë ¥í•´ì£¼ì„¸ìš”.');
      const res = await fetch('/.netlify/functions/save-wordlist',{
        method:'POST',
        headers:{'Content-Type':'application/json'},
        body: JSON.stringify({category:cat,subcategory:sub,title,words})
      });
      if(!res.ok){
        const e = await res.json().catch(()=>({error:'unknown'}));
        return alert('ì €ì¥ ì‹¤íŒ¨: '+(e.error||res.status));
      }
      alert('âœ… ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!');
      inputCategory.value=''; inputSubcategory.value=''; inputTitle.value=''; inputWords.value='';
    });

    // 2) ëª©ë¡ ë Œë”
    async function renderTree(){
      const res = await fetch('/.netlify/functions/list-wordlists');
      if(!res.ok) return alert('ëª©ë¡ ê°€ì ¸ì˜¤ê¸° ì‹¤íŒ¨');
      const items = await res.json();
      const root = document.getElementById('wordlist-tree');
      root.innerHTML='';

      const byCat = items.reduce((a,{category,subcategory,title})=>{
        a[category]=a[category]||{};
        a[category][subcategory]=a[category][subcategory]||[];
        a[category][subcategory].push(title);
        return a;
      },{});

      for(const [cat,submap] of Object.entries(byCat)){
        const d1=document.createElement('details');
        const s1=document.createElement('summary');
        s1.textContent=cat; d1.appendChild(s1);

        for(const [sub,list] of Object.entries(submap)){
          const d2=document.createElement('details');
          d2.style.marginLeft='12px';
          const s2=document.createElement('summary');
          s2.textContent=sub; d2.appendChild(s2);

          const ul=document.createElement('ul');
          list.forEach(t=>{
            const li=document.createElement('li');
            li.textContent=t;
            li.addEventListener('click', ()=>{
              if (confirm('í•´ë‹¹ ë²”ìœ„ì˜ ë‹¨ì–´ í…ŒìŠ¤íŠ¸ë¥¼ ì‹œì‘í• ê¹Œìš”?')) {
                openTestTab(t);
              }
            });
            ul.appendChild(li);
          });
          d2.appendChild(ul);
          d1.appendChild(d2);
        }
        root.appendChild(d1);
      }
    }
    load-wordlists-btn.addEventListener('click', renderTree);

    // 3) ìƒˆ íƒ­ ì—´ê¸° & í™•ì¸
    async function openTestTab(title){
      const res = await fetch(`/.netlify/functions/get-wordlist?title=${encodeURIComponent(title)}`);
      if(!res.ok) return alert('ë‹¨ì–´ì¥ ë¶ˆëŸ¬ì˜¤ê¸° ì‹¤íŒ¨');
      const words = await res.json();
      const newWin = window.open();
      const data = JSON.stringify(shuffle(words.slice()), null, 2);

      newWin.document.write(\`
<!DOCTYPE html><html lang="ko"><head><meta charset="UTF-8"><title>\${title} í…ŒìŠ¤íŠ¸</title>
<style>
  body{margin:0;padding:0;background:#000;color:#fff;
    display:flex;flex-direction:column;
    justify-content:center;align-items:center;
    height:100vh;font-family:Arial,sans-serif;}
  #slide{font-size:6rem;font-weight:600;height:1.5em;margin-bottom:40px;}
  #controls button{padding:12px 24px;margin:0 8px;
    font-size:1.2rem;border:none;border-radius:8px;
    background:#3498db;color:#fff;cursor:pointer;
    transition:.2s;}
  #controls button:hover{background:#2980b9;}
  #answers{margin-top:30px;width:80%;max-width:600px;
    text-align:left;font-size:1.1rem;line-height:1.4;}
  #answers ol{padding-left:20px;} #answers li{margin:6px 0;}
</style>
</head><body>
  <div id="slide"></div>
  <div id="controls">
    <button id="startTest">í…ŒìŠ¤íŠ¸ ì‹œì‘</button>
    <button id="showAnswers" style="display:none">ì •ë‹µ í™•ì¸</button>
  </div>
  <div id="answers"></div>
<script>
  const list = \${data}.slice(0,30);
  let idx=0, iv;
  const slide = document.getElementById('slide');
  const startBtn = document.getElementById('startTest');
  const ansBtn = document.getElementById('showAnswers');
  const answers = document.getElementById('answers');

  function showNext(){
    if(idx>=list.length){
      clearInterval(iv);
      ansBtn.style.display='inline-block';
      return;
    }
    slide.textContent = list[idx].word;
    setTimeout(()=> slide.textContent='', 3000);
    idx++;
  }

  startBtn.addEventListener('click', ()=>{
    startBtn.style.display='none';
    iv = setInterval(showNext,6000);
    showNext();
  });

  ansBtn.addEventListener('click', ()=>{
    answers.innerHTML = '<ol>' +
      list.map(o=>'<li>'+o.word+' â€” '+o.meaning+'</li>').join('') +
      '</ol>';
    ansBtn.style.display='none';
  });
<\/script>
</body></html>\`);
      newWin.document.close();
    }

    // 4) â€œí…ŒìŠ¤íŠ¸ ì‹œì‘â€ ë²„íŠ¼ ì•ˆë‚´
    start-slide-test-btn.addEventListener('click', ()=>{
      renderTree();
      alert('ì™¼ìª½ì—ì„œ ë‹¨ì–´ì¥ì„ ì„ íƒí•´ í…ŒìŠ¤íŠ¸ íƒ­ì„ ì—´ì–´ì£¼ì„¸ìš”.');
    });
  </script>

</body>
</html>
\```

- **íŒì—… í™•ì¸** í›„ ì˜ˆë¥¼ ì„ íƒí•´ì•¼ ì°½ì´ ì—´ë¦½ë‹ˆë‹¤.  
- ìƒˆ íƒ­ì—ì„œ **ì‹œì‘ ë²„íŠ¼ í´ë¦­ ì‹œ** ì‚¬ë¼ì§€ê³  ìŠ¬ë¼ì´ë“œ ì‹œì‘!  
- **ì •ë‹µ í™•ì¸** ë• ë‹¨ì–´â€“ëœ»ì´ í°ìƒ‰ í° ê¸€ì”¨ ëŒ€ë¹„ë¡œ ì˜ ë³´ì…ë‹ˆë‹¤.  

ì´ëŒ€ë¡œ ë¶™ì—¬ë„£ê³  í™•ì¸í•´ ë³´ì„¸ìš”! ğŸ˜Š
